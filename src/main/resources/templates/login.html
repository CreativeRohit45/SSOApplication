<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Login</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 1rem; }
        .container { background: #ffffff; padding: 2.5rem; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); width: 100%; max-width: 420px; text-align: center; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        h1 { color: #2c3e50; margin-bottom: 2rem; font-size: 1.8rem; font-weight: 700; }
        .form-group { margin-bottom: 1.5rem; text-align: left; }
        label { display: block; margin-bottom: 0.6rem; font-weight: 600; color: #34495e; font-size: 0.95rem; }
        input[type="text"], input[type="password"], input[type="email"] { width: 100%; padding: 0.85rem; border-radius: 6px; border: 1.5px solid #ecf0f1; box-sizing: border-box; font-size: 1rem; transition: all 0.2s ease; background-color: #f8f9fa; }
        input:focus { border-color: #667eea; background-color: #ffffff; outline: 0; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        button[type="submit"] { width: 100%; padding: 0.85rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(102,126,234,0.3); }
        button[type="submit"]:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(102,126,234,0.4); }
        .message, .error-message { padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; font-size: 0.95rem; text-align: left; border-left: 4px solid; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .error-message { background-color: #fadbd8; color: #78281f; border-left-color: #e74c3c; }
        .message { background-color: #d5f4e6; color: #0e4c27; border-left-color: #27ae60; }
        .register-link { margin-top: 1.5rem; display: block; color: #667eea; text-decoration: none; font-size: 0.95rem; font-weight: 600; transition: all 0.2s ease; }
        .register-link:hover { transform: translateY(-1px); text-decoration: underline; }
        .divider { display: flex; align-items: center; text-align: center; color: #bdc3c7; margin: 1.5rem 0; font-size: 0.9rem; font-weight: 500; }
        .divider::before, .divider::after { content: ''; flex: 1; border-bottom: 1px solid #ecf0f1; }
        .divider:not(:empty)::before { margin-right: 0.5em; }
        .divider:not(:empty)::after { margin-left: 0.5em; }
        .sso-button, .sso-jwt-button, .sso-saml-button { display: block; width: 100%; padding: 0.85rem; margin-top: 0.75rem; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; text-decoration: none; box-sizing: border-box; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .sso-button { background: linear-gradient(135deg, #4285F4 0%, #2d5aa8 100%); }
        .sso-button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(66,133,244,0.4); }
        .sso-jwt-button { background: linear-gradient(135deg, #ff9900 0%, #ff6600 100%); }
        .sso-jwt-button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(255,102,0,0.4); }
        .sso-saml-button { background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); }
        .sso-saml-button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(40,167,69,0.4); }
        @media (max-width: 768px) {
            .container { padding: 1.5rem; }
            h1 { font-size: 1.5rem; }
            .form-group { margin-bottom: 1rem; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Login</h1>

    <div th:if="${param.error}" class="error-message">
        <span th:if="${param.error == 'jwt_invalid'}">SSO login failed: Invalid token.</span>
        <span th:if="${param.error == 'auth_conversion_failed'}">SSO login failed: Could not process user details.</span>
        <span th:if="${param.error == 'sso_unexpected_error'}">SSO login failed: An unexpected error occurred.</span>
        <span th:unless="${#strings.startsWith(param.error, 'jwt_') or #strings.startsWith(param.error, 'auth_') or #strings.startsWith(param.error, 'sso_')}">
                Invalid email or password.</span>
    </div>
    <div th:if="${param.logout}" class="message">
        You have been logged out.
    </div>
    <div th:if="${param.registered}" class="message">
        Registration successful. Please log in.
    </div>

    <form th:action="@{/login}" method="post">
        <div class="form-group">
            <label for="username">Email:</label>
            <input type="email" id="username" name="username" required/>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required/>
        </div>
        <button type="submit">Sign In</button>
    </form>

    <div class="divider" th:if="${isOidcEnabled or isJwtEnabled or isSamlEnabled}">OR Sign in with</div>

    <a th:if="${isOidcEnabled}" th:href="@{/oauth2/authorization/miniorange}" class="sso-button">SSO (OIDC)</a>

    <a th:if="${isJwtEnabled}" th:href="@{/sso/jwt/login}" class="sso-jwt-button">SSO (JWT)</a>

    <a th:if="${isSamlEnabled}" th:href="@{/saml2/authenticate/miniorange-saml}" class="sso-saml-button">SSO (SAML)</a>

    <a th:href="@{/register}" class="register-link">Create an account</a>
</div>
</body>
</html>
